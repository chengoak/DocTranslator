import{_ as $,r as f,Q as b,c as q,a as d,g as s,w as l,a9 as E,I,y as u,o as U,A as g,t as B,E as n}from"./index-B_1xGcKF.js";import{f as N,b as T}from"./auth-BXzzagA-.js";const h={class:"forget-page"},D={class:"forget-container"},K={class:"forget-actions"},S={__name:"forget",setup(j){const _=I(),c=f(),o=b({email:"",code:"",password:"",password_confirmation:""}),y=b({email:[{required:!0,message:"请填写邮箱地址",trigger:"blur"}],code:[{required:!0,message:"请填写邮箱验证码",trigger:"blur"}],password:[{required:!0,message:"请填写新密码",trigger:"blur"}],password_confirmation:[{required:!0,message:"请填写确认密码",trigger:"blur"}]}),p=f("发送"),m=f(!1),V=async()=>{if(!m.value){if(!o.email.trim()){n.error("请填写邮箱地址");return}try{await N(o.email),n.success("验证码已发送"),m.value=!0;let t=60;p.value=`${t}s`;const e=setInterval(()=>{if(t<=0){clearInterval(e),m.value=!1,p.value="发送";return}t--,p.value=`${t}s`},1e3)}catch(t){n.error(t.message)}}},w=async t=>{t.validate((e,i)=>{if(e){if(o.password!==o.password_confirmation){n.error("两次密码输入不一致");return}T(o).then(r=>{r.code===200?(n.success("密码重置成功"),_.push({name:"login"})):n.error(r.message)}).catch(r=>{n.error(r.message)})}else n.error(i[Object.keys(i)[0]][0].message)})},k=()=>{_.push({name:"login"})};return(t,e)=>{const i=u("el-input"),r=u("el-form-item"),v=u("el-button"),x=u("el-link"),C=u("el-form");return U(),q("div",h,[d("div",D,[e[8]||(e[8]=d("div",{class:"forget-header"},[d("h1",{class:"forget-title"},"忘记密码"),d("p",{class:"forget-subtitle"},"请输入您的邮箱以重置密码")],-1)),s(C,{ref_key:"form",ref:c,model:o,"show-message":!1,rules:y,onKeyup:e[5]||(e[5]=E(a=>w(c.value),["enter"]))},{default:l(()=>[s(r,{label:"",prop:"email"},{default:l(()=>[s(i,{modelValue:o.email,"onUpdate:modelValue":e[0]||(e[0]=a=>o.email=a),placeholder:"输入邮箱","prefix-icon":"el-icon-message"},null,8,["modelValue"])]),_:1}),s(r,{label:"",prop:"code"},{default:l(()=>[s(i,{modelValue:o.code,"onUpdate:modelValue":e[1]||(e[1]=a=>o.code=a),placeholder:"邮箱验证码","prefix-icon":"el-icon-key"},{suffix:l(()=>[s(v,{type:"text",class:"code-btn",onClick:V,disabled:m.value},{default:l(()=>[g(B(p.value),1)]),_:1},8,["disabled"])]),_:1},8,["modelValue"])]),_:1}),s(r,{label:"",prop:"password"},{default:l(()=>[s(i,{modelValue:o.password,"onUpdate:modelValue":e[2]||(e[2]=a=>o.password=a),type:"password","show-password":"",placeholder:"设置新密码","prefix-icon":"el-icon-lock"},null,8,["modelValue"])]),_:1}),s(r,{label:"",prop:"password_confirmation"},{default:l(()=>[s(i,{modelValue:o.password_confirmation,"onUpdate:modelValue":e[3]||(e[3]=a=>o.password_confirmation=a),type:"password","show-password":"",placeholder:"确认新密码","prefix-icon":"el-icon-lock"},null,8,["modelValue"])]),_:1}),s(r,{label:"",class:"center"},{default:l(()=>[s(v,{type:"primary",size:"large",class:"forget-btn",onClick:e[4]||(e[4]=a=>w(c.value))},{default:l(()=>e[6]||(e[6]=[g(" 提交 ")])),_:1})]),_:1}),d("div",K,[s(x,{type:"primary",class:"return-link",onClick:k},{default:l(()=>e[7]||(e[7]=[g("返回登录")])),_:1})])]),_:1},8,["model","rules"])])])}}},F=$(S,[["__scopeId","data-v-f7a48b87"]]);export{F as default};
